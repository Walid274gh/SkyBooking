// src/main/idl/FlightReservation.idl

module FlightReservation {
    
    // ==================== STRUCTURES DE DONNÉES ====================
    
    struct Customer {
        string customerId;
        string username;
        string firstName;
        string lastName;
        string email;
        string phoneNumber;
    };
    
    struct LoginResponse {
    Customer customer;
    string sessionToken;
    };
    
    struct Flight {
        string flightId;
        string flightNumber;
        string airline;
        string departureCity;
        string arrivalCity;
        string departureDate;
        string departureTime;
        string arrivalDate;
        string arrivalTime;
        string duration;
        double economyPrice;
        double businessPrice;
        double firstClassPrice;
        long availableSeats;
        string aircraftType;
    };
    
    struct Seat {
        string seatNumber;
        string seatClass;
        string status;
        double price;
    };
    
    struct Passenger {
        string firstName;
        string lastName;
        string passportNumber;
        string dateOfBirth;
        string email;
        string phone;
    };
    
    struct Reservation {
        string reservationId;
        string customerId;
        string flightId;
        string status;
        double totalPrice;
        string reservationDate;
    };
    
    struct Ticket {
        string ticketId;
        string reservationId;
        string passengerName;
        string seatNumber;
        string flightNumber;
        string departureCity;
        string arrivalCity;
        string departureDate;
        string departureTime;
        double price;
    };
    
    enum PaymentMethod {
        CIB,
        EDAHABIA
    };
    
    enum PaymentStatus {
        PENDING,
        PROCESSING,
        COMPLETED,
        FAILED,
        REFUNDED
    };
    
    struct Payment {
        string paymentId;
        string reservationId;
        string customerId;
        double amount;
        PaymentMethod method;
        PaymentStatus status;
        string transactionId;
        string cardNumber;  // 4 derniers chiffres seulement
        string paymentDate;
        string bankReference;
    };
    
    struct Invoice {
        string invoiceId;
        string paymentId;
        string reservationId;
        string customerName;
        string email;
        double amount;
        double taxAmount;
        double totalAmount;
        string issueDate;
        string dueDate;
    };
    
    struct BookingHistory {
        string reservationId;
        string flightNumber;
        string departureCity;
        string arrivalCity;
        string departureDate;
        string status; // CONFIRMED, CANCELLED, COMPLETED, REFUNDED
        double totalPrice;
        string bookingDate;
        boolean canCancel;
        boolean canModify;
    };
    
    struct CancellationPolicy {
        long hoursBeforeDeparture;
        double refundPercentage;
        double penaltyFee;
    };
    
    struct ProfileUpdate {
        string customerId;
        string firstName;
        string lastName;
        string email;
        string phoneNumber;
        string currentPassword; // Pour vérification
        string newPassword; // Optionnel
    };
    
    struct PasswordReset {
        string email;
        string resetToken;
        string newPassword;
    };
    
    struct SavedPaymentMethod {
        string paymentMethodId;
        string customerId;
        string cardType; // CIB, EDAHABIA
        string maskedCardNumber;
        string cardHolderName;
        string expiryDate;
        boolean isDefault;
    };
    
    struct Destination {
        string cityName;
        string countryCode;
        string imageUrl;
        long flightCount;
        double startingPrice;
    };
    
    struct Newsletter {
        string email;
        string customerId;
        boolean subscribed;
        string subscriptionDate;
    };
    
    struct AdminUser {
        string adminId;
        string username;
        string email;
        string role; // SUPER_ADMIN, ADMIN, OPERATOR
        boolean isActive;
        string createdAt;
    };

    struct DashboardStats {
        long totalFlights;
        long totalBookings;
        long totalCustomers;
        double totalRevenue;
        long todayBookings;
        long pendingPayments;
        long availableSeats;
        double occupancyRate;
    };

    struct FlightManagementData {
        string flightId;
        string flightNumber;
        string airline;
        string departureCity;
        string arrivalCity;
        string departureDate;
        string departureTime;
        string arrivalDate;
        string arrivalTime;
        string duration;
        double economyPrice;
        double businessPrice;
        double firstClassPrice;
        long totalSeats;
        long availableSeats;
        string aircraftType;
        string status; // ACTIVE, CANCELLED, COMPLETED
    };

    struct UserManagementData {
        string customerId;
        string username;
        string firstName;
        string lastName;
        string email;
        string phoneNumber;
        long totalBookings;
        double totalSpent;
        string lastBooking;
        boolean isActive;
        string registeredAt;
    };

    struct BookingManagementData {
        string reservationId;
        string customerId;
        string customerName;
        string flightNumber;
        string route;
        string departureDate;
        string status;
        double amount;
        string paymentStatus;
        string bookingDate;
        long passengerCount;
    };

    struct FinancialReport {
        string period; // DAILY, WEEKLY, MONTHLY, YEARLY
        double totalRevenue;
        double totalRefunds;
        double netRevenue;
        long totalTransactions;
        double averageBookingValue;
        string topRoute;
        string reportDate;
    };

    struct SeatMapData {
        string flightId;
        string seatNumber;
        string seatClass;
        string status;
        double price;
        string passengerName; // si occupé
        string reservationId; // si occupé
    };

    struct PricingRule {
        string ruleId;
        string flightId;
        string seatClass;
        double basePrice;
        double peakSeasonMultiplier;
        double earlyBirdDiscount;
        double lastMinuteMultiplier;
        string validFrom;
        string validTo;
    };
    
    struct HotelManagementData {
        string hotelId;
        string hotelName;
        string city;
        string address;
        long starRating;
        string description;
        double pricePerNight;
        long totalRooms;
        long availableRooms;
        long occupiedRooms;
        string imageUrl;
        string amenities;
        double reviewScore;
        long reviewCount;
        string status; // ACTIVE, SUSPENDED, MAINTENANCE
        string createdAt;
        string updatedAt;
    };

   struct HotelBookingManagementData {
        string hotelReservationId;
        string customerId;
        string customerName;
        string hotelName;
        string city;
        string checkInDate;
        string checkOutDate;
        long numberOfNights;
        long numberOfRooms;
        double originalPrice;
        double discountPercentage;
        double finalPrice;
        string status;
        string reservationDate;
        string flightReservationId;
        boolean hasFlightDiscount;
    };
    
    struct HotelStatistics {
        long totalHotels;
        long activeHotels;
        long totalRooms;
        long occupiedRooms;
        double occupancyRate;
        long totalBookings;
        double totalRevenue;
        string topCity;
        string topHotel;
    };

    
    typedef sequence<Flight> FlightList;
    typedef sequence<Seat> SeatList;
    typedef sequence<Passenger> PassengerList;
    typedef sequence<string> SeatNumberList;
    typedef sequence<Ticket> TicketList;
    typedef sequence<Payment> PaymentList;
    typedef sequence<Invoice> InvoiceList;
    typedef sequence<BookingHistory> BookingHistoryList;
    typedef sequence<SavedPaymentMethod> PaymentMethodList;
    typedef sequence<Destination> DestinationList;
    typedef sequence<FlightManagementData> FlightManagementList;
    typedef sequence<UserManagementData> UserManagementList;
    typedef sequence<BookingManagementData> BookingManagementList;
    typedef sequence<SeatMapData> SeatMapList;
    typedef sequence<PricingRule> PricingRuleList;
    typedef sequence<HotelManagementData> HotelManagementList;
    typedef sequence<HotelBookingManagementData> HotelBookingManagementList;

    
    // ==================== EXCEPTIONS ====================
    
    exception InvalidCredentialsException {
        string message;
    };
    
    exception FlightNotFoundException {
        string message;
    };
    
    exception SeatNotAvailableException {
        string message;
    };
    
    exception ReservationException {
        string message;
    };
    
    exception CustomerAlreadyExistsException {
        string message;
    };
    
    exception PaymentException {
        string message;
    };
    
    exception InsufficientFundsException {
        string message;
    };
    
    exception InvalidCardException {
        string message;
    };
    
    exception RefundException {
        string message;
    };
    
    exception CancellationNotAllowedException {
        string message;
        long hoursRemaining;
    };
    
    exception ModificationNotAllowedException {
        string message;
    };
    
    exception InvalidPasswordException {
        string message;
    };
    
    exception ResetTokenExpiredException {
        string message;
    };
    
    exception AdminAuthException {
        string message;
    };

    exception AdminPermissionException {
        string message;
    };

    exception FlightManagementException {
        string message;
    };
    
    exception HotelManagementException {
    string message;
    };
    
    
    // ==================== INTERFACES CORBA ====================
    
    // Interface de gestion des clients
    interface CustomerManager {
        LoginResponse login(in string username, in string password)
            raises (InvalidCredentialsException);
        
        LoginResponse registerCustomer(
            in string username,
            in string password,
            in string firstName,
            in string lastName,
            in string email,
            in string phoneNumber
        ) raises (CustomerAlreadyExistsException);
        
        Customer getCustomerById(in string customerId);
        
        boolean updateCustomer(in Customer customer);
        
        void logout(in string customerId);
        
        Customer validateSession(in string customerId, in string token)
        raises (InvalidCredentialsException);
    };
    
    // Interface de recherche et gestion des vols
    interface FlightManager {
        FlightList searchFlights(
            in string departureCity,
            in string arrivalCity,
            in string date,
            in string seatClass
        );
        
        Flight getFlightById(in string flightId)
            raises (FlightNotFoundException);
        
        SeatList getAvailableSeats(in string flightId)
            raises (FlightNotFoundException);
        
        boolean isSeatAvailable(in string flightId, in string seatNumber);
    };
    
    // Interface de gestion des réservations
    interface ReservationManager {
        Reservation createReservation(
            in string customerId,
            in string flightId,
            in SeatNumberList seatNumbers,
            in PassengerList passengers
        ) raises (SeatNotAvailableException, ReservationException);
    
        Reservation getReservation(in string reservationId);
        TicketList getTickets(in string reservationId);
        Ticket getTicketById(in string ticketId)
        raises (ReservationException);
        
        Reservation getReservationByTicketId(in string ticketId)
        raises (ReservationException);
    
        boolean cancelReservation(in string reservationId);
    
        typedef sequence<Reservation> ReservationList;
        ReservationList getCustomerReservations(in string customerId);
    };
    
    // interface Payment
    interface PaymentManager {
        Payment processPayment(
            in string reservationId,
            in string customerId,
            in double amount,
            in PaymentMethod method,
            in string cardNumber,
            in string cardHolder,
            in string expiryDate,
            in string cvv
        ) raises (PaymentException, InsufficientFundsException, InvalidCardException);
        
        Payment getPayment(in string paymentId);
        
        PaymentList getCustomerPayments(in string customerId);
        
        boolean refundPayment(in string paymentId)
            raises (RefundException);
        
        Invoice generateInvoice(in string paymentId);
        
        Invoice getInvoice(in string invoiceId);
        
        InvoiceList getCustomerInvoices(in string customerId);
    };
    
    interface AccountManager {
        // Historique des réservations
        BookingHistoryList getBookingHistory(in string customerId);
        BookingHistory getBookingDetails(in string reservationId);
        
        // Gestion du profil
        boolean updateProfile(in ProfileUpdate profileData)
            raises (InvalidPasswordException);
        
        boolean changePassword(in string customerId, in string currentPassword, in string newPassword)
            raises (InvalidPasswordException);
        
        // Réinitialisation mot de passe
        string requestPasswordReset(in string email);
        boolean resetPassword(in PasswordReset resetData)
            raises (ResetTokenExpiredException);
        
        // Méthodes de paiement sauvegardées
        SavedPaymentMethod savePaymentMethod(in SavedPaymentMethod paymentMethod);
        PaymentMethodList getSavedPaymentMethods(in string customerId);
        boolean deletePaymentMethod(in string paymentMethodId);
        boolean setDefaultPaymentMethod(in string paymentMethodId);
        
        // Destinations favorites
        DestinationList getPopularDestinations();
        DestinationList getFavoriteDestinations(in string customerId);
        boolean addFavoriteDestination(in string customerId, in string cityName);
        boolean removeFavoriteDestination(in string customerId, in string cityName);
        
        // Newsletter
        boolean subscribeNewsletter(in Newsletter newsletter);
        boolean unsubscribeNewsletter(in string email);
    };
    
    // GESTIONNAIRE D'ANNULATION/MODIFICATION
    
    interface CancellationManager {
        // Politique d'annulation
        CancellationPolicy getCancellationPolicy(in string reservationId);
        double calculateRefundAmount(in string reservationId);
        
        // Annulation
        boolean cancelReservation(in string reservationId, in string reason)
            raises (CancellationNotAllowedException);
        
        // Modification
        boolean canModifyReservation(in string reservationId);
        boolean modifySeats(in string reservationId, in SeatNumberList newSeats)
            raises (ModificationNotAllowedException, SeatNotAvailableException);
        
        // Changement de vol (upgrade complexe)
        FlightList getAlternativeFlights(in string reservationId);
        boolean changeFlight(in string reservationId, in string newFlightId)
            raises (ModificationNotAllowedException);
    };
    
    // ==================== INTERFACE ADMIN ====================

    interface AdminManager {
        // ========== AUTHENTIFICATION ==========
        AdminUser adminLogin(in string username, in string password)
            raises (AdminAuthException);
    
        boolean validateAdminSession(in string adminId, in string token)
            raises (AdminAuthException);
    
        void adminLogout(in string adminId);
    
        // ========== DASHBOARD ==========
        DashboardStats getDashboardStats();
    
        FinancialReport getFinancialReport(in string period, in string startDate, in string endDate);
    
        // ========== GESTION DES VOLS ==========
        FlightManagementList getAllFlights();
    
        FlightManagementData getFlightDetails(in string flightId)
            raises (FlightNotFoundException);
    
        string createFlight(in FlightManagementData flightData)
            raises (FlightManagementException);
    
        boolean updateFlight(in FlightManagementData flightData)
           raises (FlightManagementException);

        boolean deleteFlight(in string flightId)
            raises (FlightManagementException);
    
        boolean cancelFlight(in string flightId, in string reason)
            raises (FlightManagementException);
   
        // ========== GESTION DES UTILISATEURS ==========
        UserManagementList getAllUsers();
    
        UserManagementData getUserDetails(in string customerId);
    
        boolean suspendUser(in string customerId, in string reason);
    
        boolean activateUser(in string customerId);
    
        boolean deleteUser(in string customerId);
    
        // ========== GESTION DES RÉSERVATIONS ==========
        BookingManagementList getAllBookings();
    
        BookingManagementList getBookingsByStatus(in string status);
    
        BookingManagementList getBookingsByDate(in string startDate, in string endDate);
    
        boolean cancelBookingAdmin(in string reservationId, in string reason);
    
        boolean modifyBookingAdmin(in string reservationId, in SeatNumberList newSeats);
    
        // ========== GESTION DES SIÈGES ==========
        SeatMapList getSeatMap(in string flightId);
    
        boolean updateSeatPrice(in string flightId, in string seatNumber, in double newPrice);
    
        boolean blockSeat(in string flightId, in string seatNumber, in string reason);
   
        boolean unblockSeat(in string flightId, in string seatNumber);
    
        // ========== GESTION DES PRIX ==========
        PricingRuleList getPricingRules(in string flightId);
    
        string createPricingRule(in PricingRule rule);
    
        boolean updatePricingRule(in PricingRule rule);
    
        boolean deletePricingRule(in string ruleId);
    
    // ========== GESTION DES HÔTELS ==========
        HotelManagementList getAllHotels();

        HotelManagementData getHotelDetails(in string hotelId)
            raises (HotelNotFoundException);

        string createHotel(in HotelManagementData hotelData)
            raises (HotelManagementException);

        boolean updateHotel(in HotelManagementData hotelData)
            raises (HotelManagementException);

        boolean deleteHotel(in string hotelId)
            raises (HotelManagementException);

        boolean suspendHotel(in string hotelId, in string reason)
            raises (HotelManagementException);

        boolean activateHotel(in string hotelId)
            raises (HotelManagementException);

    // ========== GESTION DES RÉSERVATIONS D'HÔTELS ==========
       HotelBookingManagementList getAllHotelBookings();

       HotelBookingManagementList getHotelBookingsByStatus(in string status);

       HotelBookingManagementList getHotelBookingsByDateRange(
           in string startDate, 
           in string endDate
        );

        HotelBookingManagementList getHotelBookingsByHotel(in string hotelId);

        boolean cancelHotelBookingAdmin(in string hotelReservationId, in string reason);
        
    // ========== STATISTIQUES HÔTELS ==========

        HotelStatistics getHotelStatistics();
        
        // ========== RAPPORTS ==========
        string generateFullReport(in string reportType, in string startDate, in string endDate);
    
        typedef sequence<string> StringList;
        StringList getTopRoutes(in long limit);
        StringList getTopCustomers(in long limit);
        
        // ========== RAPPORTS HÔTELS ==========
        StringList getTopHotels(in long limit);
        StringList getTopCities(in long limit);
    };
    
    // Interface principale du système
    interface FlightBookingSystem {
        CustomerManager getCustomerManager();
        FlightManager getFlightManager();
        ReservationManager getReservationManager();
        PaymentManager getPaymentManager();
        AccountManager getAccountManager();
        CancellationManager getCancellationManager();
        AdminManager getAdminManager();
    };
};
